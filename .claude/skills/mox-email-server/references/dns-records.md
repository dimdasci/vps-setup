# DNS Records for Mox Email Server

## Required Records

Replace `example.com` with your domain and `YOUR_SERVER_IP` with your VPS IP address.

### A Records

```dns
mail.example.com.        IN  A    YOUR_SERVER_IP
mta-sts.example.com.     IN  A    YOUR_SERVER_IP
autoconfig.example.com.  IN  A    YOUR_SERVER_IP
```

### MX Record

```dns
example.com.             IN  MX   10 mail.example.com.
```

### SPF Record

Basic SPF allowing only your mail server:
```dns
example.com.             IN  TXT  "v=spf1 mx ~all"
```

Stricter version (reject instead of soft-fail):
```dns
example.com.             IN  TXT  "v=spf1 mx -all"
```

### DMARC Record

Quarantine policy with reporting:
```dns
_dmarc.example.com.      IN  TXT  "v=DMARC1; p=quarantine; rua=mailto:dmarcreports@example.com"
```

Stricter reject policy:
```dns
_dmarc.example.com.      IN  TXT  "v=DMARC1; p=reject; rua=mailto:dmarcreports@example.com; pct=100"
```

### MTA-STS Record

```dns
_mta-sts.example.com.    IN  TXT  "v=STSv1; id=1"
```

Increment `id` value when updating the MTA-STS policy.

### TLS Reporting Record

```dns
_smtp._tls.example.com.  IN  TXT  "v=TLSRPTv1; rua=mailto:tlsreports@example.com"
```

### DKIM Record

Generated by `mox quickstart`. Format:
```dns
<selector>._domainkey.example.com.  IN  TXT  "v=DKIM1; k=rsa; p=<public-key>"
```

The selector and public key are output during quickstart.

## Verification Commands

Check MX record:
```bash
dig MX example.com +short
```

Check SPF:
```bash
dig TXT example.com +short | grep spf
```

Check DMARC:
```bash
dig TXT _dmarc.example.com +short
```

Check DKIM:
```bash
dig TXT <selector>._domainkey.example.com +short
```

Check MTA-STS:
```bash
dig TXT _mta-sts.example.com +short
```

## DNS Propagation

DNS changes can take up to 48 hours to propagate globally. Use these tools to check:
- https://dnschecker.org/
- https://mxtoolbox.com/

## Common Issues

**DKIM not validating**: Ensure the TXT record doesn't have line breaks. Some DNS providers require splitting long values.

**SPF too many lookups**: SPF has a 10 DNS lookup limit. Use `mx` instead of listing IPs when possible.

**MTA-STS not working**: Ensure the `id` value is incremented after policy changes.
