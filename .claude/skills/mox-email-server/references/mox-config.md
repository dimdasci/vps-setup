# Mox Configuration Reference

## sconf Format

Mox uses `sconf` format (not YAML):
- Indent with **tabs only** (not spaces)
- Comments must be on their own line (not at end of line)
- Do not escape or quote strings
- Boolean values: `true` or `false`

## mox.conf Structure

Location: `/home/mox/config/mox.conf`

### Global Settings

```sconf
# Data directory (relative to config directory)
DataDir: ../data

# Log level: error, info, debug, trace, traceauth, tracedata
LogLevel: info

# System user to run as
User: mox

# Full hostname for the mail server
Hostname: mail.example.com

# Admin password file location
AdminPasswordFile: adminpasswd
```

### ACME Configuration

For automatic Let's Encrypt certificates (when Mox handles TLS directly):

```sconf
ACME:
	letsencrypt:
		DirectoryURL: https://acme-v02.api.letsencrypt.org/directory
		ContactEmail: admin@example.com
		IssuerDomainName: letsencrypt.org
```

### Listeners

#### Internal Listener (Admin/Webmail)

For Caddy reverse proxy setup, include Docker bridge IPs:

```sconf
Listeners:
	internal:
		IPs:
			- 127.0.0.1
			- ::1
			- 172.17.0.1
			- 172.18.0.1
			- 172.19.0.1
			- 172.20.0.1
			- 172.21.0.1
			- 172.22.0.1

		# Required for admin interface through Caddy
		Hostname: localhost

		AccountHTTP:
			Enabled: true
			Port: 8080

		AdminHTTP:
			Enabled: true
			Port: 8080

		WebmailHTTP:
			Enabled: true
			Port: 8080

		WebAPIHTTP:
			Enabled: true
			Port: 8080

		# For Caddy-proxied autoconfig/MTA-STS
		AutoconfigHTTPS:
			Enabled: true
			Port: 8080
			NonTLS: true

		MTASTSHTTPS:
			Enabled: true
			Port: 8080
			NonTLS: true
```

#### Public Listener (SMTP/IMAP)

```sconf
	public:
		IPs:
			- 0.0.0.0

		# File-based TLS (certs from Caddy)
		TLS:
			KeyCerts:
				-
					CertFile: /home/mox/certs/mail.example.com.crt
					KeyFile: /home/mox/certs/mail.example.com.key

		SMTP:
			Enabled: true

		Submissions:
			Enabled: true

		Submission:
			Enabled: true

		IMAPS:
			Enabled: true
```

### Postmaster Configuration

```sconf
Postmaster:
	Account: admin
	Mailbox: Postmaster
```

### TLS Reporting

```sconf
HostTLSRPT:
	Account: admin
	Mailbox: TLSRPT
	Localpart: tlsreports
```

### Log Retention

```sconf
Log:
	Level: info
	MaxSize: 100m
	MaxAge: 7
	MaxBackups: 3
	Compress: true
```

## domains.conf

Location: `/home/mox/config/domains.conf`

Generated by quickstart. Contains domain-specific settings including DKIM keys.

## Useful Commands

Test configuration:
```bash
sudo -u mox /home/mox/mox config test
```

Reload after config changes:
```bash
systemctl reload mox
```

View current config:
```bash
sudo -u mox /home/mox/mox config describe
```
